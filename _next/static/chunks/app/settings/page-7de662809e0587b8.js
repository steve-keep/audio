(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{803:function(){},5897:function(e,t,n){Promise.resolve().then(n.bind(n,8972))},2561:function(e,t,n){"use strict";n.d(t,{EP:function(){return m},Lj:function(){return I},UM:function(){return f},Xs:function(){return y},ZG:function(){return p},Zi:function(){return g},aU:function(){return w},bN:function(){return N},eK:function(){return R},fC:function(){return b},gG:function(){return T},zK:function(){return E}});var r=n(2040),a=n.n(r);let i=null,l=null,o="audio-indexer-db",u="database";async function s(){return l||(l=await a()({locateFile:e=>"https://sql.js.org/dist/".concat(e)}))}function c(){return new Promise((e,t)=>{let n=indexedDB.open(o,1);n.onerror=()=>t("Error opening IndexedDB"),n.onsuccess=()=>e(n.result),n.onupgradeneeded=e=>{e.target.result.createObjectStore(u)}})}async function d(){let e=await c();return new Promise((t,n)=>{let r=e.transaction(u,"readonly").objectStore(u).get("db");r.onerror=()=>n("Error loading from IndexedDB"),r.onsuccess=()=>t(r.result)})}async function f(){if(!i)return;let e=i.export();(await c()).transaction(u,"readwrite").objectStore(u).put(e,"db")}async function E(){if(i)return i;let e=await s(),t=await d();return(i=t?new e.Database(t):new e.Database)&&i.run("\n    CREATE TABLE IF NOT EXISTS tracks (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      title TEXT,\n      artist TEXT,\n      album TEXT,\n      track TEXT\n    );\n    CREATE TABLE IF NOT EXISTS artists (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT UNIQUE,\n      imageUrl TEXT\n    );\n    CREATE TABLE IF NOT EXISTS albums (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT,\n      artistName TEXT,\n      imageUrl TEXT,\n      UNIQUE(name, artistName)\n    );\n  "),i}function T(e){if(!i)return;let t=i.prepare("INSERT INTO tracks (title, artist, album, track) VALUES (?, ?, ?, ?)");t.run([e.title,e.artist,e.album,e.track]),t.free()}function m(e){if(!i)return;let t=i.prepare("INSERT OR IGNORE INTO artists (name, imageUrl) VALUES (?, ?)");t.run([e.name,e.imageUrl]),t.free()}function p(e){if(!i)return;let t=i.prepare("INSERT OR IGNORE INTO albums (name, artistName, imageUrl) VALUES (?, ?, ?)");t.run([e.name,e.artistName,e.imageUrl]),t.free()}function b(){if(!i)return[];let e=i.exec("SELECT DISTINCT artist FROM tracks ORDER BY artist");return 0===e.length?[]:e[0].values.map(e=>null==e?void 0:e[0])}function w(e){if(!i)return null;let t=i.prepare("SELECT name, imageUrl FROM artists WHERE name = ?");if(t.bind([e]),t.step()){let e=t.getAsObject();return t.free(),e}return t.free(),null}function R(e,t){if(!i)return null;let n=i.prepare("SELECT name, artistName, imageUrl FROM albums WHERE name = ? AND artistName = ?");if(n.bind([e,t]),n.step()){let e=n.getAsObject();return n.free(),e}return n.free(),null}function N(e){if(!i)return[];let t=i.prepare("SELECT DISTINCT album FROM tracks WHERE artist = ? ORDER BY album");t.bind([e]);let n=[];for(;t.step();)n.push(t.get()[0]);return t.free(),n}function y(){return i?i.export():null}async function g(e){let t=await s();i&&i.close(),i=new t.Database(e),await f()}async function I(){return i&&(i.close(),i=null),new Promise((e,t)=>{let n=indexedDB.deleteDatabase(o);n.onerror=()=>t("Error deleting database"),n.onsuccess=()=>e()})}},8972:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return l}});var r=n(7437),a=n(2265),i=n(2561);function l(){let[e,t]=(0,a.useState)(!1),[l,o]=(0,a.useState)(!1),[u,s]=(0,a.useState)(0),[c,d]=(0,a.useState)(null),f=(0,a.useRef)(null);(0,a.useEffect)(()=>(t("showDirectoryPicker"in window),(0,i.zK)(),f.current=new Worker(n.tu(new URL(n.p+n.u(714),n.b))),f.current.onmessage=async e=>{if("progress"===e.data.type)s(e.data.payload);else if("complete"===e.data.type){for(let t of e.data.payload)(0,i.gG)(t);await (0,i.UM)(),o(!1)}else"error"===e.data.type&&(console.error(e.data.payload),o(!1))},()=>{var e;null===(e=f.current)||void 0===e||e.terminate()}),[]);let E=async()=>{try{var e;o(!0),s(0);let t=await window.showDirectoryPicker();null===(e=f.current)||void 0===e||e.postMessage(t)}catch(e){console.error("Error selecting directory:",e),o(!1)}},T=async()=>{if(c){let e=new FileReader;e.onload=async e=>{var t;if(null===(t=e.target)||void 0===t?void 0:t.result){let t=new Uint8Array(e.target.result);await (0,i.Zi)(t),alert("Database restored successfully. The application will now reload."),window.location.reload()}},e.readAsArrayBuffer(c)}};return(0,r.jsxs)("main",{children:[(0,r.jsx)("h1",{children:"Settings"}),e?(0,r.jsx)("button",{onClick:E,disabled:l,children:l?"Scanning...":"Select Directory"}):(0,r.jsx)("p",{children:"The File System Access API is not supported in your browser."}),l&&(0,r.jsx)("progress",{value:u,max:"100"}),(0,r.jsx)("hr",{}),(0,r.jsx)("button",{onClick:()=>{let e=(0,i.Xs)();if(e){let t=new Blob([new Uint8Array(e)]),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="audio-indexer.db",r.click(),URL.revokeObjectURL(n)}},children:"Backup Database"}),(0,r.jsx)("hr",{}),(0,r.jsx)("input",{type:"file",onChange:e=>{var t;return d((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}}),(0,r.jsx)("button",{onClick:T,disabled:!c,children:"Restore Database"}),(0,r.jsx)("hr",{}),(0,r.jsx)("button",{onClick:async()=>{window.confirm("Are you sure you want to delete the database?")&&(await (0,i.Lj)(),alert("Database deleted successfully. The application will now reload."),window.location.reload())},children:"Delete Database"})]})}}},function(e){e.O(0,[218,251,128,971,23,744],function(){return e(e.s=5897)}),_N_E=e.O()}]);