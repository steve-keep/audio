(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{9627:function(){},4059:function(){},7401:function(e,t,a){Promise.resolve().then(a.bind(a,914))},914:function(e,t,a){"use strict";a.r(t);var r=a(7437),s=a(2265),i=a(2638),n=a.n(i),l=a(6647),c=a.n(l),o=a(1666),d=a(7589),m=a(9432),h=a(9109).Buffer;let u=[".mp3",".flac",".m4a"];t.default=()=>{let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!1),[l,f]=(0,s.useState)(null),[w,g]=(0,s.useState)(""),[x,j]=(0,s.useState)([]),[p,b]=(0,s.useState)([]),[y,T]=(0,s.useState)(!1),[_,v]=(0,s.useState)(!1),E=(0,s.useRef)(null),S=(0,s.useRef)(null),[k,F]=(0,s.useState)("jsmediatags");(0,s.useEffect)(()=>{(async()=>{let e=new d.C,t="/audio/vendor/ffmpeg-core";await e.load({coreURL:await (0,m.Wn)("".concat(t,"/ffmpeg-core.js"),"text/javascript"),wasmURL:await (0,m.Wn)("".concat(t,"/ffmpeg-core.wasm"),"application/wasm")}),E.current=e,v(!0)})()},[]),(0,s.useEffect)(()=>{let e=async()=>{if(window.taglibWasm){let e=await fetch("/audio/vendor/taglib-wasm/taglib.wasm"),t=await e.arrayBuffer(),a=await window.taglibWasm.TagLib.initialize({wasmBinary:t});S.current=a,T(!0)}};if(window.taglibWasm)e();else{let t=document.createElement("script");return t.src="/audio/vendor/taglib-wasm/lib-via-script-tag.js",t.async=!0,t.onload=e,t.onerror=()=>console.error("Failed to load the taglib-wasm script."),document.body.appendChild(t),()=>{document.body.removeChild(t)}}},[]);let N=async()=>{try{let e=await window.showDirectoryPicker();f(e),t([]),g("Selected directory: ".concat(e.name))}catch(e){e instanceof DOMException&&"AbortError"===e.name?console.log("Directory selection was canceled."):console.error("Error selecting directory:",e)}},P=async e=>{let t=[],a=async e=>{for await(let r of e.values())"file"===r.kind?u.some(e=>r.name.toLowerCase().endsWith(e))&&t.push(r):"directory"===r.kind&&await a(r)};return await a(e),t},C=async(e,a)=>{t([]),j([]),b([]),g("Testing ".concat(a,"..."));let r=performance.now(),s=0,i=[],n=[];try{if("jsmediatags"===a)for(let t of e){let e=await t.getFile();await new Promise((t,a)=>{c().read(e,{onSuccess:e=>{n.push(e.tags),t()},onError:e=>a(e)})}),s++}else if("music-metadata-browser"===a)for(let t of e){let e=await t.getFile(),a=h.from(await e.arrayBuffer()),r=await o.yY(a);n.push(r.common),s++}else if("taglib-wasm"===a){if(y&&S.current)for(let t of e)try{let e=await t.getFile(),a=await e.arrayBuffer(),r=new Uint8Array(a),i=await S.current.open(r,e.name),l=i.tag();n.push({title:l.title,artist:l.artist,album:l.album,year:l.year,track:l.track,genre:l.genre}),i.dispose(),s++}catch(a){let e="taglib-wasm failed to process ".concat(t.name,": ").concat(a instanceof Error?a.message:String(a));console.error(e),i.push(e)}else throw Error("taglib-wasm is not loaded.")}else if("ffmpeg.wasm"===a){if(_&&E.current){let t=E.current;for(let a of e){let e=await a.getFile(),r=await e.arrayBuffer(),i=new Uint8Array(r);await t.writeFile(e.name,i),await t.exec(["-i",e.name,"-f","ffmetadata","metadata.txt"]);let l=await t.readFile("metadata.txt"),c={};new TextDecoder("utf-8").decode(l).split("\n").forEach(e=>{let[t,...a]=e.split("=");t&&a.length>0&&(c[t.trim()]=a.join("=").trim())}),n.push(c),s++}}else throw Error("ffmpeg.wasm is not loaded.")}}catch(e){g("Error during testing ".concat(a,": ").concat(e instanceof Error?e.message:String(e))),console.error(e),t([{library:a,filesProcessed:s,timeTaken:performance.now()-r}]),j(i);return}t([{library:a,filesProcessed:s,timeTaken:performance.now()-r}]),j(i),b(n)},L=async()=>{if(!l)return;i(!0),g("Scanning directory for audio files...");let e=await P(l);g("Found ".concat(e.length," audio files. Now running test...")),await C(e,k),i(!1),g("Testing complete. Processed ".concat(e.length," files with ").concat(k,"."))};return(0,r.jsxs)("div",{className:n().container,children:[(0,r.jsx)("h1",{children:"Metadata Speed Test"}),(0,r.jsxs)("div",{className:n().form,children:[(0,r.jsx)("button",{onClick:N,disabled:a,children:l?"Selected: ".concat(l.name):"Select Directory"}),(0,r.jsxs)("select",{value:k,onChange:e=>F(e.target.value),children:[(0,r.jsx)("option",{value:"jsmediatags",children:"jsmediatags"}),(0,r.jsx)("option",{value:"music-metadata-browser",children:"music-metadata-browser"}),(0,r.jsx)("option",{value:"taglib-wasm",children:"taglib-wasm"}),(0,r.jsx)("option",{value:"ffmpeg.wasm",children:"ffmpeg.wasm"})]}),(0,r.jsx)("button",{onClick:L,disabled:!l||a||"taglib-wasm"===k&&!y||"ffmpeg.wasm"===k&&!_,children:a?"Scanning...":"Run Test"})]}),!y&&(0,r.jsx)("p",{children:"Loading metadata library..."}),w&&(0,r.jsx)("p",{children:w}),x.length>0&&(0,r.jsxs)("div",{className:n().errors,children:[(0,r.jsx)("h2",{children:"Errors"}),(0,r.jsx)("ul",{children:x.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),e.length>0&&(0,r.jsxs)("div",{className:n().results,children:[(0,r.jsx)("h2",{children:"Results"}),(0,r.jsxs)("table",{className:n().resultsTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Library"}),(0,r.jsx)("th",{children:"Files Processed"}),(0,r.jsx)("th",{children:"Time Taken (ms)"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.library}),(0,r.jsx)("td",{children:e.filesProcessed}),(0,r.jsx)("td",{children:e.timeTaken.toFixed(2)})]},e.library))})]})]}),p.length>0&&(0,r.jsxs)("div",{className:n().results,children:[(0,r.jsx)("h2",{children:"Extracted Tags"}),(0,r.jsxs)("table",{className:n().resultsTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Title"}),(0,r.jsx)("th",{children:"Artist"}),(0,r.jsx)("th",{children:"Album"}),(0,r.jsx)("th",{children:"Year"}),(0,r.jsx)("th",{children:"Track"}),(0,r.jsx)("th",{children:"Genre"})]})}),(0,r.jsx)("tbody",{children:p.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.title}),(0,r.jsx)("td",{children:e.artist}),(0,r.jsx)("td",{children:e.album}),(0,r.jsx)("td",{children:e.year}),(0,r.jsx)("td",{children:e.track}),(0,r.jsx)("td",{children:e.genre})]},t))})]})]})]})}},2638:function(e){e.exports={container:"TestPage_container__UH0HI",form:"TestPage_form__XLLAj",results:"TestPage_results__2V4Bx",resultsTable:"TestPage_resultsTable__KMCwU",errors:"TestPage_errors__IR6FX"}}},function(e){e.O(0,[781,646,647,142,971,190,744],function(){return e(e.s=7401)}),_N_E=e.O()}]);