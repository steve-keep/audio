(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{7401:function(e,t,r){Promise.resolve().then(r.bind(r,914))},3639:function(e,t,r){"use strict";r.d(t,{ScanProgressProvider:function(){return l},w:function(){return i}});var a=r(7437),s=r(2265);let n=(0,s.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,s.useState)("idle"),[i,c]=(0,s.useState)(0),[o,d]=(0,s.useState)(0);return(0,a.jsx)(n.Provider,{value:{status:r,found:i,processed:o,setStatus:l,setFound:c,setProcessed:d,reset:()=>{l("idle"),c(0),d(0)}},children:t})},i=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useScanProgress must be used within a ScanProgressProvider");return e}},914:function(e,t,r){"use strict";r.r(t);var a=r(7437),s=r(2265),n=r(3639),l=r(2638),i=r.n(l),c=r(6647),o=r.n(c),d=r(7589),h=r(9722);let u=[".mp3",".flac",".m4a"];t.default=()=>{let[e,t]=(0,s.useState)([]),[l,c]=(0,s.useState)(!1),[m,f]=(0,s.useState)(null),[g,w]=(0,s.useState)(""),[x,j]=(0,s.useState)([]),[p,y]=(0,s.useState)([]),[P,b]=(0,s.useState)(!1),S=(0,s.useRef)(null),[v,T]=(0,s.useState)(!1),[E,_]=(0,s.useState)("jsmediatags"),{setStatus:k,setFound:C,setProcessed:F,reset:N}=(0,n.w)();(0,s.useEffect)(()=>{(async()=>{let e=new d.C;await e.load(),S.current=e,b(!0);try{await (0,h.ZP)(),T(!0)}catch(e){console.error("Failed to initialize id3-wasm",e)}})()},[]);let M=async()=>{try{let e=await window.showDirectoryPicker();f(e),t([]),w("Selected directory: ".concat(e.name))}catch(e){e instanceof DOMException&&"AbortError"===e.name?console.log("Directory selection was canceled."):console.error("Error selecting directory:",e)}},A=async e=>{let t=[],r=async e=>{for await(let a of e.values())"file"===a.kind?u.some(e=>a.name.toLowerCase().endsWith(e))&&t.push(a):"directory"===a.kind&&await r(a)};return await r(e),t},L=async(e,r)=>{t([]),j([]),y([]),w("Testing ".concat(r,"..."));let a=performance.now(),s=0,n=[],l=[];C(e.length),F(0);try{if("jsmediatags"===r)for(let t of e){let e=await t.getFile();await new Promise((t,r)=>{o().read(e,{onSuccess:e=>{l.push(e.tags),t()},onError:e=>r(e)})}),s++,F(s)}else if("ffmpeg.wasm"===r){if(P&&S.current){let t=S.current;for(let r of e){let e=await r.getFile(),a=await e.arrayBuffer(),n=new Uint8Array(a);await t.writeFile(e.name,n),await t.exec(["-i",e.name,"-f","ffmetadata","metadata.txt"]);let i=await t.readFile("metadata.txt"),c={};new TextDecoder("utf-8").decode(i).split("\n").forEach(e=>{let[t,...r]=e.split("=");t&&r.length>0&&(c[t.trim()]=r.join("=").trim())}),l.push(c),s++,F(s)}}else throw Error("ffmpeg.wasm is not loaded.")}else if("id3-wasm"===r){if(v)for(let t of e){let e,r;if(!t.name.toLowerCase().endsWith(".mp3"))continue;let a=await t.getFile(),i=await a.arrayBuffer(),c=new Uint8Array(i);try{let t={title:(r=(e=h.UW.from(c)).getMetadata()).title,artist:r.artist,album:r.album,year:r.year,track:r.track,genre:r.genre};l.push(t)}catch(r){let e=r instanceof Error?r.message:String(r);n.push("".concat(t.name,": ").concat(e))}finally{r&&r.free(),e&&e.free()}s++,F(s)}else throw Error("id3-wasm is not loaded.")}}catch(e){w("Error during testing ".concat(r,": ").concat(e instanceof Error?e.message:String(e))),console.error(e),t([{library:r,filesProcessed:s,timeTaken:performance.now()-a}]),j(n);return}t([{library:r,filesProcessed:s,timeTaken:performance.now()-a}]),j(n),y(l)},U=async(e,a)=>{t([]),j([]),y([]),w("Testing ".concat(a," in parallel..."));let s=performance.now();C(e.length),F(0);let n=navigator.hardwareConcurrency||2,l=[],i=Math.ceil(e.length/n),c=[];for(let t=0;t<n;t++){let s=new Worker(r.tu(new URL(r.p+r.u(359),r.b)),{type:void 0});l.push(s);let n=t*i,o=n+i,d=e.slice(n,o);if(d.length>0){let e=new Promise((e,t)=>{s.onmessage=r=>{r.data.error?t(Error(r.data.error)):(F(e=>e+r.data.results.length),e(r.data)),s.terminate()},s.onerror=e=>{t(e),s.terminate()},Promise.all(d.map(e=>e.getFile())).then(e=>{s.postMessage({files:e,library:a})})});c.push(e)}}try{let e=await Promise.all(c),r=e.flatMap(e=>e.results),n=e.flatMap(e=>e.errors),l=performance.now();t([{library:"".concat(a," (Parallel)"),filesProcessed:r.length,timeTaken:l-s}]),j(n),y(r)}catch(r){let e=performance.now();w("Error during parallel testing: ".concat(r instanceof Error?r.message:String(r))),t([{library:"".concat(a," (Parallel)"),filesProcessed:0,timeTaken:e-s}])}finally{l.forEach(e=>e.terminate())}},D=async()=>{if(m){c(!0),N(),k("running"),w("Scanning directory for audio files...");try{let e=await A(m);w("Found ".concat(e.length," audio files. Now running test...")),C(e.length),E.endsWith("-parallel")?await U(e,E.replace("-parallel","")):await L(e,E),k("success"),w("Testing complete. Processed ".concat(e.length," files with ").concat(E,"."))}catch(e){k("error"),w("An error occurred during the test."),console.error(e)}finally{c(!1)}}};return(0,a.jsxs)("div",{className:i().container,children:[(0,a.jsx)("h1",{children:"Metadata Speed Test"}),(0,a.jsxs)("div",{className:i().form,children:[(0,a.jsx)("button",{onClick:M,disabled:l,children:m?"Selected: ".concat(m.name):"Select Directory"}),(0,a.jsxs)("select",{value:E,onChange:e=>_(e.target.value),children:[(0,a.jsx)("option",{value:"jsmediatags",children:"jsmediatags"}),(0,a.jsx)("option",{value:"ffmpeg.wasm",children:"ffmpeg.wasm"}),(0,a.jsx)("option",{value:"id3-wasm",children:"id3-wasm"}),(0,a.jsx)("option",{value:"jsmediatags-parallel",children:"jsmediatags (Parallel)"}),(0,a.jsx)("option",{value:"ffmpeg.wasm-parallel",children:"ffmpeg.wasm (Parallel)"}),(0,a.jsx)("option",{value:"id3-wasm-parallel",children:"id3-wasm (Parallel)"})]}),(0,a.jsx)("button",{onClick:D,disabled:!m||l||"ffmpeg.wasm"===E&&!P||"id3-wasm"===E&&!v,children:l?"Scanning...":"Run Test"})]}),g&&(0,a.jsx)("p",{children:g}),x.length>0&&(0,a.jsxs)("div",{className:i().errors,children:[(0,a.jsx)("h2",{children:"Errors"}),(0,a.jsx)("ul",{children:x.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]}),e.length>0&&(0,a.jsxs)("div",{className:i().results,children:[(0,a.jsx)("h2",{children:"Results"}),(0,a.jsxs)("table",{className:i().resultsTable,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Library"}),(0,a.jsx)("th",{children:"Files Processed"}),(0,a.jsx)("th",{children:"Time Taken (ms)"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.library}),(0,a.jsx)("td",{children:e.filesProcessed}),(0,a.jsx)("td",{children:e.timeTaken.toFixed(2)})]},e.library))})]})]}),p.length>0&&(0,a.jsxs)("div",{className:i().results,children:[(0,a.jsx)("h2",{children:"Extracted Tags"}),(0,a.jsxs)("table",{className:i().resultsTable,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Title"}),(0,a.jsx)("th",{children:"Artist"}),(0,a.jsx)("th",{children:"Album"}),(0,a.jsx)("th",{children:"Year"}),(0,a.jsx)("th",{children:"Track"}),(0,a.jsx)("th",{children:"Genre"})]})}),(0,a.jsx)("tbody",{children:p.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.title}),(0,a.jsx)("td",{children:e.artist}),(0,a.jsx)("td",{children:e.album}),(0,a.jsx)("td",{children:e.year}),(0,a.jsx)("td",{children:e.track}),(0,a.jsx)("td",{children:e.genre})]},t))})]})]})]})}},2638:function(e){e.exports={container:"TestPage_container__UH0HI",form:"TestPage_form__XLLAj",results:"TestPage_results__2V4Bx",resultsTable:"TestPage_resultsTable__KMCwU",errors:"TestPage_errors__IR6FX"}}},function(e){e.O(0,[781,646,647,634,971,190,744],function(){return e(e.s=7401)}),_N_E=e.O()}]);