(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{7401:function(e,t,a){Promise.resolve().then(a.bind(a,914))},914:function(e,t,a){"use strict";a.r(t);var r=a(7437),s=a(2265),l=a(2638),n=a.n(l),i=a(6647),c=a.n(i),o=a(7589),d=a(9722);let h=[".mp3",".flac",".m4a"];t.default=()=>{let[e,t]=(0,s.useState)([]),[l,i]=(0,s.useState)(!1),[m,f]=(0,s.useState)(null),[u,w]=(0,s.useState)(""),[g,x]=(0,s.useState)([]),[j,p]=(0,s.useState)([]),[y,b]=(0,s.useState)(!1),T=(0,s.useRef)(null),[P,_]=(0,s.useState)(!1),[k,E]=(0,s.useState)("jsmediatags");(0,s.useEffect)(()=>{(async()=>{let e=new o.C;await e.load(),T.current=e,b(!0);try{await (0,d.ZP)(),_(!0)}catch(e){console.error("Failed to initialize id3-wasm",e)}})()},[]);let S=async()=>{try{let e=await window.showDirectoryPicker();f(e),t([]),w("Selected directory: ".concat(e.name))}catch(e){e instanceof DOMException&&"AbortError"===e.name?console.log("Directory selection was canceled."):console.error("Error selecting directory:",e)}},v=async e=>{let t=[],a=async e=>{for await(let r of e.values())"file"===r.kind?h.some(e=>r.name.toLowerCase().endsWith(e))&&t.push(r):"directory"===r.kind&&await a(r)};return await a(e),t},F=async(e,a)=>{t([]),x([]),p([]),w("Testing ".concat(a,"..."));let r=performance.now(),s=0,l=[],n=[];try{if("jsmediatags"===a)for(let t of e){let e=await t.getFile();await new Promise((t,a)=>{c().read(e,{onSuccess:e=>{n.push(e.tags),t()},onError:e=>a(e)})}),s++}else if("ffmpeg.wasm"===a){if(y&&T.current){let t=T.current;for(let a of e){let e=await a.getFile(),r=await e.arrayBuffer(),l=new Uint8Array(r);await t.writeFile(e.name,l),await t.exec(["-i",e.name,"-f","ffmetadata","metadata.txt"]);let i=await t.readFile("metadata.txt"),c={};new TextDecoder("utf-8").decode(i).split("\n").forEach(e=>{let[t,...a]=e.split("=");t&&a.length>0&&(c[t.trim()]=a.join("=").trim())}),n.push(c),s++}}else throw Error("ffmpeg.wasm is not loaded.")}else if("id3-wasm"===a){if(P)for(let t of e){let e,a;if(!t.name.toLowerCase().endsWith(".mp3"))continue;let r=await t.getFile(),i=await r.arrayBuffer(),c=new Uint8Array(i);try{let t={title:(a=(e=d.UW.from(c)).getMetadata()).title,artist:a.artist,album:a.album,year:a.year,track:a.track,genre:a.genre};n.push(t)}catch(a){let e=a instanceof Error?a.message:String(a);l.push("".concat(t.name,": ").concat(e))}finally{a&&a.free(),e&&e.free()}s++}else throw Error("id3-wasm is not loaded.")}}catch(e){w("Error during testing ".concat(a,": ").concat(e instanceof Error?e.message:String(e))),console.error(e),t([{library:a,filesProcessed:s,timeTaken:performance.now()-r}]),x(l);return}t([{library:a,filesProcessed:s,timeTaken:performance.now()-r}]),x(l),p(n)},N=async(e,r)=>{t([]),x([]),p([]),w("Testing ".concat(r," in parallel..."));let s=performance.now(),l=navigator.hardwareConcurrency||2,n=[],i=Math.ceil(e.length/l),c=[];for(let t=0;t<l;t++){let s=new Worker(a.tu(new URL(a.p+a.u(359),a.b)),{type:void 0});n.push(s);let l=t*i,o=l+i,d=e.slice(l,o);if(d.length>0){let e=new Promise((e,t)=>{s.onmessage=a=>{a.data.error?t(Error(a.data.error)):e(a.data),s.terminate()},s.onerror=e=>{t(e),s.terminate()},Promise.all(d.map(e=>e.getFile())).then(e=>{s.postMessage({files:e,library:r})})});c.push(e)}}try{let e=await Promise.all(c),a=e.flatMap(e=>e.results),l=e.flatMap(e=>e.errors),n=performance.now();t([{library:"".concat(r," (Parallel)"),filesProcessed:a.length,timeTaken:n-s}]),x(l),p(a)}catch(a){let e=performance.now();w("Error during parallel testing: ".concat(a instanceof Error?a.message:String(a))),t([{library:"".concat(r," (Parallel)"),filesProcessed:0,timeTaken:e-s}])}finally{n.forEach(e=>e.terminate())}},C=async()=>{if(!m)return;i(!0),w("Scanning directory for audio files...");let e=await v(m);w("Found ".concat(e.length," audio files. Now running test...")),k.endsWith("-parallel")?await N(e,k.replace("-parallel","")):await F(e,k),i(!1),w("Testing complete. Processed ".concat(e.length," files with ").concat(k,"."))};return(0,r.jsxs)("div",{className:n().container,children:[(0,r.jsx)("h1",{children:"Metadata Speed Test"}),(0,r.jsxs)("div",{className:n().form,children:[(0,r.jsx)("button",{onClick:S,disabled:l,children:m?"Selected: ".concat(m.name):"Select Directory"}),(0,r.jsxs)("select",{value:k,onChange:e=>E(e.target.value),children:[(0,r.jsx)("option",{value:"jsmediatags",children:"jsmediatags"}),(0,r.jsx)("option",{value:"ffmpeg.wasm",children:"ffmpeg.wasm"}),(0,r.jsx)("option",{value:"id3-wasm",children:"id3-wasm"}),(0,r.jsx)("option",{value:"jsmediatags-parallel",children:"jsmediatags (Parallel)"}),(0,r.jsx)("option",{value:"ffmpeg.wasm-parallel",children:"ffmpeg.wasm (Parallel)"}),(0,r.jsx)("option",{value:"id3-wasm-parallel",children:"id3-wasm (Parallel)"})]}),(0,r.jsx)("button",{onClick:C,disabled:!m||l||"ffmpeg.wasm"===k&&!y||"id3-wasm"===k&&!P,children:l?"Scanning...":"Run Test"})]}),u&&(0,r.jsx)("p",{children:u}),g.length>0&&(0,r.jsxs)("div",{className:n().errors,children:[(0,r.jsx)("h2",{children:"Errors"}),(0,r.jsx)("ul",{children:g.map((e,t)=>(0,r.jsx)("li",{children:e},t))})]}),e.length>0&&(0,r.jsxs)("div",{className:n().results,children:[(0,r.jsx)("h2",{children:"Results"}),(0,r.jsxs)("table",{className:n().resultsTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Library"}),(0,r.jsx)("th",{children:"Files Processed"}),(0,r.jsx)("th",{children:"Time Taken (ms)"})]})}),(0,r.jsx)("tbody",{children:e.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.library}),(0,r.jsx)("td",{children:e.filesProcessed}),(0,r.jsx)("td",{children:e.timeTaken.toFixed(2)})]},e.library))})]})]}),j.length>0&&(0,r.jsxs)("div",{className:n().results,children:[(0,r.jsx)("h2",{children:"Extracted Tags"}),(0,r.jsxs)("table",{className:n().resultsTable,children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Title"}),(0,r.jsx)("th",{children:"Artist"}),(0,r.jsx)("th",{children:"Album"}),(0,r.jsx)("th",{children:"Year"}),(0,r.jsx)("th",{children:"Track"}),(0,r.jsx)("th",{children:"Genre"})]})}),(0,r.jsx)("tbody",{children:j.map((e,t)=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.title}),(0,r.jsx)("td",{children:e.artist}),(0,r.jsx)("td",{children:e.album}),(0,r.jsx)("td",{children:e.year}),(0,r.jsx)("td",{children:e.track}),(0,r.jsx)("td",{children:e.genre})]},t))})]})]})]})}},2638:function(e){e.exports={container:"TestPage_container__UH0HI",form:"TestPage_form__XLLAj",results:"TestPage_results__2V4Bx",resultsTable:"TestPage_resultsTable__KMCwU",errors:"TestPage_errors__IR6FX"}}},function(e){e.O(0,[781,646,647,634,971,190,744],function(){return e(e.s=7401)}),_N_E=e.O()}]);