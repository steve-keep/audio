(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{7401:function(e,t,s){Promise.resolve().then(s.bind(s,123))},123:function(e,t,s){"use strict";let r;s.r(t),s.d(t,{default:function(){return T}});var a,i,n,l,o=s(7437),c=s(2265),d=s(2638),h=s.n(d),E=s(6647),f=s.n(E);(a=n||(n={})).LOAD="LOAD",a.EXEC="EXEC",a.FFPROBE="FFPROBE",a.WRITE_FILE="WRITE_FILE",a.READ_FILE="READ_FILE",a.DELETE_FILE="DELETE_FILE",a.RENAME="RENAME",a.CREATE_DIR="CREATE_DIR",a.LIST_DIR="LIST_DIR",a.DELETE_DIR="DELETE_DIR",a.ERROR="ERROR",a.DOWNLOAD="DOWNLOAD",a.PROGRESS="PROGRESS",a.LOG="LOG",a.MOUNT="MOUNT",a.UNMOUNT="UNMOUNT";let u=(r=0,()=>r++);Error("unknown message type");let m=Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),w=Error("called FFmpeg.terminate()");Error("failed to import ffmpeg-core.js");class g{#e=null;#t={};#s={};#r=[];#a=[];loaded=!1;#i=()=>{this.#e&&(this.#e.onmessage=({data:{id:e,type:t,data:s}})=>{switch(t){case n.LOAD:this.loaded=!0,this.#t[e](s);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.FFPROBE:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#t[e](s);break;case n.LOG:this.#r.forEach(e=>e(s));break;case n.PROGRESS:this.#a.forEach(e=>e(s));break;case n.ERROR:this.#s[e](s)}delete this.#t[e],delete this.#s[e]})};#n=({type:e,data:t},s=[],r)=>this.#e?new Promise((a,i)=>{let n=u();this.#e&&this.#e.postMessage({id:n,type:e,data:t},s),this.#t[n]=a,this.#s[n]=i,r?.addEventListener("abort",()=>{i(new DOMException(`Message # ${n} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(m);on(e,t){"log"===e?this.#r.push(t):"progress"===e&&this.#a.push(t)}off(e,t){"log"===e?this.#r=this.#r.filter(e=>e!==t):"progress"===e&&(this.#a=this.#a.filter(e=>e!==t))}load=({classWorkerURL:e,...t}={},{signal:r}={})=>(this.#e||(this.#e=e?new Worker(new URL(e,"file:///home/runner/work/audio/audio/node_modules/@ffmpeg/ffmpeg/dist/esm/classes.js"),{type:"module"}):new Worker(s.tu(new URL(s.p+s.u(72),s.b)),{type:void 0}),this.#i()),this.#n({type:n.LOAD,data:t},void 0,r));exec=(e,t=-1,{signal:s}={})=>this.#n({type:n.EXEC,data:{args:e,timeout:t}},void 0,s);ffprobe=(e,t=-1,{signal:s}={})=>this.#n({type:n.FFPROBE,data:{args:e,timeout:t}},void 0,s);terminate=()=>{for(let e of Object.keys(this.#s))this.#s[e](w),delete this.#s[e],delete this.#t[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(e,t,{signal:s}={})=>{let r=[];return t instanceof Uint8Array&&r.push(t.buffer),this.#n({type:n.WRITE_FILE,data:{path:e,data:t}},r,s)};mount=(e,t,s)=>this.#n({type:n.MOUNT,data:{fsType:e,options:t,mountPoint:s}},[]);unmount=e=>this.#n({type:n.UNMOUNT,data:{mountPoint:e}},[]);readFile=(e,t="binary",{signal:s}={})=>this.#n({type:n.READ_FILE,data:{path:e,encoding:t}},void 0,s);deleteFile=(e,{signal:t}={})=>this.#n({type:n.DELETE_FILE,data:{path:e}},void 0,t);rename=(e,t,{signal:s}={})=>this.#n({type:n.RENAME,data:{oldPath:e,newPath:t}},void 0,s);createDir=(e,{signal:t}={})=>this.#n({type:n.CREATE_DIR,data:{path:e}},void 0,t);listDir=(e,{signal:t}={})=>this.#n({type:n.LIST_DIR,data:{path:e}},void 0,t);deleteDir=(e,{signal:t}={})=>this.#n({type:n.DELETE_DIR,data:{path:e}},void 0,t)}(i=l||(l={})).MEMFS="MEMFS",i.NODEFS="NODEFS",i.NODERAWFS="NODERAWFS",i.IDBFS="IDBFS",i.WORKERFS="WORKERFS",i.PROXYFS="PROXYFS";let p=Error("failed to get response body reader"),R=Error("failed to complete download"),j=async(e,t)=>{let s;let r=await fetch(e);try{let a=parseInt(r.headers.get("Content-Length")||"-1"),i=r.body?.getReader();if(!i)throw p;let n=[],l=0;for(;;){let{done:s,value:r}=await i.read(),o=r?r.length:0;if(s){if(-1!=a&&a!==l)throw R;t&&t({url:e,total:a,received:l,delta:o,done:s});break}n.push(r),l+=o,t&&t({url:e,total:a,received:l,delta:o,done:s})}let o=new Uint8Array(l),c=0;for(let e of n)o.set(e,c),c+=e.length;s=o.buffer}catch(a){console.log("failed to send download progress event: ",a),s=await r.arrayBuffer(),t&&t({url:e,total:s.byteLength,received:s.byteLength,delta:0,done:!0})}return s},x=async(e,t,s=!1,r)=>{let a=new Blob([s?await j(e,r):await (await fetch(e)).arrayBuffer()],{type:t});return URL.createObjectURL(a)},y=[".mp3",".flac",".m4a"];var T=()=>{let[e,t]=(0,c.useState)([]),[s,r]=(0,c.useState)(!1),[a,i]=(0,c.useState)(null),[n,l]=(0,c.useState)(""),[d,E]=(0,c.useState)([]),[u,m]=(0,c.useState)([]),[w,p]=(0,c.useState)(!1),R=(0,c.useRef)(null),[j,T]=(0,c.useState)("jsmediatags");(0,c.useEffect)(()=>{(async()=>{let e=new g,t="/audio/vendor/ffmpeg-core";await e.load({coreURL:await x("".concat(t,"/ffmpeg-core.js"),"text/javascript"),wasmURL:await x("".concat(t,"/ffmpeg-core.wasm"),"application/wasm")}),R.current=e,p(!0)})()},[]);let b=async()=>{try{let e=await window.showDirectoryPicker();i(e),t([]),l("Selected directory: ".concat(e.name))}catch(e){e instanceof DOMException&&"AbortError"===e.name?console.log("Directory selection was canceled."):console.error("Error selecting directory:",e)}},D=async e=>{let t=[],s=async e=>{for await(let r of e.values())"file"===r.kind?y.some(e=>r.name.toLowerCase().endsWith(e))&&t.push(r):"directory"===r.kind&&await s(r)};return await s(e),t},L=async(e,s)=>{t([]),E([]),m([]),l("Testing ".concat(s,"..."));let r=performance.now(),a=0,i=[],n=[];try{if("jsmediatags"===s)for(let t of e){let e=await t.getFile();await new Promise((t,s)=>{f().read(e,{onSuccess:e=>{n.push(e.tags),t()},onError:e=>s(e)})}),a++}else if("ffmpeg.wasm"===s){if(w&&R.current){let t=R.current;for(let s of e){let e=await s.getFile(),r=await e.arrayBuffer(),i=new Uint8Array(r);await t.writeFile(e.name,i),await t.exec(["-i",e.name,"-f","ffmetadata","metadata.txt"]);let l=await t.readFile("metadata.txt"),o={};new TextDecoder("utf-8").decode(l).split("\n").forEach(e=>{let[t,...s]=e.split("=");t&&s.length>0&&(o[t.trim()]=s.join("=").trim())}),n.push(o),a++}}else throw Error("ffmpeg.wasm is not loaded.")}}catch(e){l("Error during testing ".concat(s,": ").concat(e instanceof Error?e.message:String(e))),console.error(e),t([{library:s,filesProcessed:a,timeTaken:performance.now()-r}]),E(i);return}t([{library:s,filesProcessed:a,timeTaken:performance.now()-r}]),E(i),m(n)},_=async()=>{if(!a)return;r(!0),l("Scanning directory for audio files...");let e=await D(a);l("Found ".concat(e.length," audio files. Now running test...")),await L(e,j),r(!1),l("Testing complete. Processed ".concat(e.length," files with ").concat(j,"."))};return(0,o.jsxs)("div",{className:h().container,children:[(0,o.jsx)("h1",{children:"Metadata Speed Test"}),(0,o.jsxs)("div",{className:h().form,children:[(0,o.jsx)("button",{onClick:b,disabled:s,children:a?"Selected: ".concat(a.name):"Select Directory"}),(0,o.jsxs)("select",{value:j,onChange:e=>T(e.target.value),children:[(0,o.jsx)("option",{value:"jsmediatags",children:"jsmediatags"}),(0,o.jsx)("option",{value:"ffmpeg.wasm",children:"ffmpeg.wasm"})]}),(0,o.jsx)("button",{onClick:_,disabled:!a||s||"ffmpeg.wasm"===j&&!w,children:s?"Scanning...":"Run Test"})]}),n&&(0,o.jsx)("p",{children:n}),d.length>0&&(0,o.jsxs)("div",{className:h().errors,children:[(0,o.jsx)("h2",{children:"Errors"}),(0,o.jsx)("ul",{children:d.map((e,t)=>(0,o.jsx)("li",{children:e},t))})]}),e.length>0&&(0,o.jsxs)("div",{className:h().results,children:[(0,o.jsx)("h2",{children:"Results"}),(0,o.jsxs)("table",{className:h().resultsTable,children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Library"}),(0,o.jsx)("th",{children:"Files Processed"}),(0,o.jsx)("th",{children:"Time Taken (ms)"})]})}),(0,o.jsx)("tbody",{children:e.map(e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.library}),(0,o.jsx)("td",{children:e.filesProcessed}),(0,o.jsx)("td",{children:e.timeTaken.toFixed(2)})]},e.library))})]})]}),u.length>0&&(0,o.jsxs)("div",{className:h().results,children:[(0,o.jsx)("h2",{children:"Extracted Tags"}),(0,o.jsxs)("table",{className:h().resultsTable,children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Title"}),(0,o.jsx)("th",{children:"Artist"}),(0,o.jsx)("th",{children:"Album"}),(0,o.jsx)("th",{children:"Year"}),(0,o.jsx)("th",{children:"Track"}),(0,o.jsx)("th",{children:"Genre"})]})}),(0,o.jsx)("tbody",{children:u.map((e,t)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.title}),(0,o.jsx)("td",{children:e.artist}),(0,o.jsx)("td",{children:e.album}),(0,o.jsx)("td",{children:e.year}),(0,o.jsx)("td",{children:e.track}),(0,o.jsx)("td",{children:e.genre})]},t))})]})]})]})}},2638:function(e){e.exports={container:"TestPage_container__UH0HI",form:"TestPage_form__XLLAj",results:"TestPage_results__2V4Bx",resultsTable:"TestPage_resultsTable__KMCwU",errors:"TestPage_errors__IR6FX"}}},function(e){e.O(0,[781,646,647,971,190,744],function(){return e(e.s=7401)}),_N_E=e.O()}]);