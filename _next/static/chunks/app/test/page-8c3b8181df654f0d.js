(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{7401:function(e,t,r){Promise.resolve().then(r.bind(r,914))},3639:function(e,t,r){"use strict";r.d(t,{ScanProgressProvider:function(){return l},w:function(){return i}});var a=r(7437),s=r(2265);let n=(0,s.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,s.useState)("idle"),[i,c]=(0,s.useState)(0),[o,d]=(0,s.useState)(0);return(0,a.jsx)(n.Provider,{value:{status:r,found:i,processed:o,setStatus:l,setFound:c,setProcessed:d,reset:()=>{l("idle"),c(0),d(0)}},children:t})},i=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useScanProgress must be used within a ScanProgressProvider");return e}},914:function(e,t,r){"use strict";r.r(t);var a=r(7437),s=r(2265),n=r(3639),l=r(2638),i=r.n(l),c=r(6647),o=r.n(c),d=r(7589),h=r(9722);let u=[".mp3",".flac",".m4a"];t.default=()=>{let[e,t]=(0,s.useState)([]),[l,c]=(0,s.useState)(!1),[m,f]=(0,s.useState)(null),[w,g]=(0,s.useState)(""),[p,x]=(0,s.useState)([]),[j,y]=(0,s.useState)([]),[P,v]=(0,s.useState)(!1),b=(0,s.useRef)(null),[T,S]=(0,s.useState)(!1),[k,E]=(0,s.useState)("jsmediatags"),{setStatus:_,setFound:C,setProcessed:F,reset:N}=(0,n.w)();(0,s.useEffect)(()=>{(async()=>{let e=new d.C;await e.load(),b.current=e,v(!0);try{await (0,h.ZP)(),S(!0)}catch(e){console.error("Failed to initialize id3-wasm",e)}})()},[]);let M=async()=>{try{let e=await window.showDirectoryPicker();f(e),t([]),g("Selected directory: ".concat(e.name))}catch(e){e instanceof DOMException&&"AbortError"===e.name?console.log("Directory selection was canceled."):console.error("Error selecting directory:",e)}},A=async(e,t,r,a)=>{let s=[],n=0,l=[],i=0,c=[e];for(;c.length>0;)for await(let e of c.pop().values())if(++i%100==0&&await new Promise(e=>setTimeout(e,0)),"file"===e.kind){if(u.some(t=>e.name.toLowerCase().endsWith(t))&&(s.push(e),C(++n),s.length>=t)){let e=r(s);a?(l.push(e),await new Promise(e=>setTimeout(e,0))):await e,s=[]}}else"directory"===e.kind&&c.push(e);if(s.length>0){let e=r(s);a?l.push(e):await e}a&&await Promise.all(l)},L=async e=>{if(!m)return;t([]),x([]),y([]),g("Testing ".concat(e,"..."));let r=performance.now(),a=0;F(0);let s=async s=>{let n=[],l=[];if("jsmediatags"===e)await Promise.all(s.map(async e=>{let t=await e.getFile();return new Promise(r=>{o().read(t,{onSuccess:e=>{n.push(e.tags),r()},onError:t=>{l.push("".concat(e.name,": ").concat(t.type," - ").concat(t.info)),r()}})})}));else if("ffmpeg.wasm"===e){if(!P||!b.current)throw Error("ffmpeg.wasm is not loaded.");let e=b.current;for(let t of s)try{let r=await t.getFile(),a=await r.arrayBuffer(),s=new Uint8Array(a);await e.writeFile(r.name,s),await e.exec(["-i",r.name,"-f","ffmetadata","metadata.txt"]);let l=await e.readFile("metadata.txt"),i={};new TextDecoder("utf-8").decode(l).split("\n").forEach(e=>{let[t,...r]=e.split("=");t&&r.length>0&&(i[t.trim()]=r.join("=").trim())}),n.push(i)}catch(r){let e=r instanceof Error?r.message:String(r);l.push("".concat(t.name,": ").concat(e))}}else if("id3-wasm"===e){if(!T)throw Error("id3-wasm is not loaded.");for(let e of s){let t,r;if(!e.name.toLowerCase().endsWith(".mp3"))continue;let a=await e.getFile(),s=new Uint8Array(await a.arrayBuffer());try{r=(t=h.UW.from(s)).getMetadata(),n.push({title:r.title,artist:r.artist,album:r.album,year:r.year,track:r.track,genre:r.genre})}catch(r){let t=r instanceof Error?r.message:String(r);l.push("".concat(e.name,": ").concat(t))}finally{r&&r.free(),t&&t.free()}}}F(a+=s.length),y(e=>[...e,...n]),x(e=>[...e,...l]);let i=performance.now();t([{library:e,filesProcessed:a,timeTaken:i-r}]),g("Processing... Processed: ".concat(a))};try{await A(m,20,s,!1);let n=performance.now();t([{library:e,filesProcessed:a,timeTaken:n-r}])}catch(l){let s=l instanceof Error?l.message:String(l);g("Error during testing ".concat(e,": ").concat(s)),console.error(l);let n=performance.now();t(t=>{var s;return[{library:(null===(s=t[0])||void 0===s?void 0:s.library)||e,filesProcessed:a,timeTaken:n-r}]})}},U=async e=>{if(!m)return;t([]),x([]),y([]),g("Testing ".concat(e," in parallel..."));let a=performance.now();F(0);let s=async s=>{let n=navigator.hardwareConcurrency||4,l=[],i=Math.ceil(s.length/n);for(let t=0;t<n;t++){let a=new Worker(r.tu(new URL(r.p+r.u(359),r.b)),{type:void 0}),n=t*i,c=n+i,o=s.slice(n,c);if(o.length>0){let t=new Promise((t,r)=>{a.onmessage=e=>{e.data.error?r(Error(e.data.error)):t(e.data),a.terminate()},a.onerror=e=>{r(e),a.terminate()},Promise.all(o.map(e=>e.getFile())).then(t=>{a.postMessage({files:t,library:e})})});l.push(t)}}let c=await Promise.all(l),o=c.flatMap(e=>e.results),d=c.flatMap(e=>e.errors),h=o.length;F(e=>e+h),y(e=>[...e,...o]),x(e=>[...e,...d]);let u=performance.now();t(t=>{var r;let s=((null===(r=t[0])||void 0===r?void 0:r.filesProcessed)||0)+h;return[{library:"".concat(e," (Parallel)"),filesProcessed:s,timeTaken:u-a}]}),g(e=>{let t=e.match(/Processed: (\d+)/),r=t?parseInt(t[1],10):0;return"Processing... Processed: ".concat(r+h)})};try{let r=navigator.hardwareConcurrency||4;await A(m,10*r,s,!1);let n=performance.now();t(t=>{var r;let s=(null===(r=t[0])||void 0===r?void 0:r.filesProcessed)||0;return[{library:"".concat(e," (Parallel)"),filesProcessed:s,timeTaken:n-a}]})}catch(n){let r=n instanceof Error?n.message:String(n);g("Error during parallel testing: ".concat(r));let s=performance.now();t(t=>{var r;let n=(null===(r=t[0])||void 0===r?void 0:r.filesProcessed)||0;return[{library:"".concat(e," (Parallel)"),filesProcessed:n,timeTaken:s-a}]})}},D=async()=>{if(m){c(!0),N(),C(0),F(0),_("running"),g("Starting test...");try{let e=k.replace("-parallel","");k.endsWith("-parallel")?await U(e):await L(e),_("success"),g("Testing complete for ".concat(k,"."))}catch(t){_("error");let e=t instanceof Error?t.message:String(t);g("An error occurred during the test: ".concat(e)),console.error(t)}finally{c(!1)}}};return(0,a.jsxs)("div",{className:i().container,children:[(0,a.jsx)("h1",{children:"Metadata Speed Test"}),(0,a.jsxs)("div",{className:i().form,children:[(0,a.jsx)("button",{onClick:M,disabled:l,children:m?"Selected: ".concat(m.name):"Select Directory"}),(0,a.jsxs)("select",{value:k,onChange:e=>E(e.target.value),children:[(0,a.jsx)("option",{value:"jsmediatags",children:"jsmediatags"}),(0,a.jsx)("option",{value:"ffmpeg.wasm",children:"ffmpeg.wasm"}),(0,a.jsx)("option",{value:"id3-wasm",children:"id3-wasm"}),(0,a.jsx)("option",{value:"jsmediatags-parallel",children:"jsmediatags (Parallel)"}),(0,a.jsx)("option",{value:"ffmpeg.wasm-parallel",children:"ffmpeg.wasm (Parallel)"}),(0,a.jsx)("option",{value:"id3-wasm-parallel",children:"id3-wasm (Parallel)"})]}),(0,a.jsx)("button",{onClick:D,disabled:!m||l||"ffmpeg.wasm"===k&&!P||"id3-wasm"===k&&!T,children:l?"Scanning...":"Run Test"})]}),w&&(0,a.jsx)("p",{children:w}),p.length>0&&(0,a.jsxs)("div",{className:i().errors,children:[(0,a.jsx)("h2",{children:"Errors"}),(0,a.jsx)("ul",{children:p.map((e,t)=>(0,a.jsx)("li",{children:e},t))})]}),e.length>0&&(0,a.jsxs)("div",{className:i().results,children:[(0,a.jsx)("h2",{children:"Results"}),(0,a.jsxs)("table",{className:i().resultsTable,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Library"}),(0,a.jsx)("th",{children:"Files Processed"}),(0,a.jsx)("th",{children:"Time Taken (ms)"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.library}),(0,a.jsx)("td",{children:e.filesProcessed}),(0,a.jsx)("td",{children:e.timeTaken.toFixed(2)})]},e.library))})]})]}),j.length>0&&(0,a.jsxs)("div",{className:i().results,children:[(0,a.jsx)("h2",{children:"Extracted Tags"}),(0,a.jsxs)("table",{className:i().resultsTable,children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Title"}),(0,a.jsx)("th",{children:"Artist"}),(0,a.jsx)("th",{children:"Album"}),(0,a.jsx)("th",{children:"Year"}),(0,a.jsx)("th",{children:"Track"}),(0,a.jsx)("th",{children:"Genre"})]})}),(0,a.jsx)("tbody",{children:j.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:e.title}),(0,a.jsx)("td",{children:e.artist}),(0,a.jsx)("td",{children:e.album}),(0,a.jsx)("td",{children:e.year}),(0,a.jsx)("td",{children:e.track}),(0,a.jsx)("td",{children:e.genre})]},t))})]})]})]})}},2638:function(e){e.exports={container:"TestPage_container__UH0HI",form:"TestPage_form__XLLAj",results:"TestPage_results__2V4Bx",resultsTable:"TestPage_resultsTable__KMCwU",errors:"TestPage_errors__IR6FX"}}},function(e){e.O(0,[781,646,647,634,971,190,744],function(){return e(e.s=7401)}),_N_E=e.O()}]);