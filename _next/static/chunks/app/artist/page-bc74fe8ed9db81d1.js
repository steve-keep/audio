(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[366],{803:function(){},64:function(t,e,r){Promise.resolve().then(r.bind(r,9321))},9321:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return d}});var n=r(7437),a=r(2265),i=r(7138),s=r(2561),l=r(6517);function u(t){let{artistName:e,artistImageUrl:r}=t;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"artist-header",children:[(0,n.jsx)("img",{src:r,alt:e,className:"artist-header-image"}),(0,n.jsx)("h1",{className:"artist-header-name",children:e})]}),(0,n.jsx)("div",{className:"sticky-header",children:(0,n.jsx)("h2",{children:e})})]})}function c(t){let{allAlbums:e,libraryAlbums:r}=t,[i,s]=(0,a.useState)("all");return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"album-tabs",children:[(0,n.jsx)("button",{onClick:()=>s("all"),className:"all"===i?"active":"",children:"All Albums"}),(0,n.jsx)("button",{onClick:()=>s("library"),className:"library"===i?"active":"",children:"In Library"})]}),(0,n.jsx)("div",{children:"all"===i?e:r})]})}var o=r(3624);function m(t){let{albums:e,showLibraryIcon:r}=t;return(0,n.jsx)("div",{className:"grid-container",children:e.map(t=>(0,n.jsxs)(i.default,{href:"/album#".concat(encodeURIComponent(t.artistName),"/").concat(encodeURIComponent(t.name)),className:"grid-item",children:[t.imageUrl&&(0,n.jsx)("img",{src:t.imageUrl,alt:t.name}),(0,n.jsxs)("h3",{children:[t.name,r&&r(t.name)&&(0,n.jsx)(o.Z,{})]})]},"".concat(t.artistName,"-").concat(t.name)))})}function d(){let[t,e]=(0,a.useState)(null),[r,o]=(0,a.useState)([]),[d,E]=(0,a.useState)([]),[f,p]=(0,a.useState)(""),[h,b]=(0,a.useState)(!0);return((0,a.useEffect)(()=>{let t=()=>{p(decodeURIComponent(window.location.hash.substring(1)))};return t(),window.addEventListener("hashchange",t),()=>{window.removeEventListener("hashchange",t)}},[]),(0,a.useEffect)(()=>{f&&(async()=>{b(!0),await (0,s.zK)();let t=(0,s.aU)(f);if(t&&!t.imageUrl)try{var r,n;let e=await fetch("https://www.theaudiodb.com/api/v1/json/".concat(l.$,"/search.php?s=").concat(f)),a=await e.json(),i=(null===(n=a.artists)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.strArtistThumb)||"/placeholder.svg";t={...t,imageUrl:i},(0,s.EP)(t)}catch(e){console.error("Error fetching artist image:",e),t={...t,imageUrl:"/placeholder.svg"}}e(t);let a=(0,s.bN)(f);o(await Promise.all(a.map(async t=>{if(t.imageUrl)return t;try{var e,r;let n=await fetch("https://www.theaudiodb.com/api/v1/json/".concat(l.$,"/searchalbum.php?s=").concat(f,"&a=").concat(t.name)),a=await n.json(),i=(null===(r=a.album)||void 0===r?void 0:null===(e=r[0])||void 0===e?void 0:e.strAlbumThumb)||"/placeholder.svg",u={name:t.name,artistName:f,imageUrl:i};return(0,s.ZG)(u),{...t,imageUrl:i}}catch(e){return console.error("Error fetching album image:",e),{...t,imageUrl:"/placeholder.svg"}}})));let i=localStorage.getItem("artist-albums-".concat(f));if(i){let{timestamp:t,data:e}=JSON.parse(i);if(Date.now()-t<864e5){E(e),b(!1);return}}try{let t=await fetch("https://www.theaudiodb.com/api/v1/json/".concat(l.$,"/searchalbum.php?s=").concat(f)),e=await t.json();if(e.album){let t=e.album.map(t=>({name:t.strAlbum,artistName:f,imageUrl:t.strAlbumThumb||"/placeholder.svg"}));E(t),localStorage.setItem("artist-albums-".concat(f),JSON.stringify({timestamp:Date.now(),data:t}))}}catch(t){console.error("Error fetching all albums:",t)}b(!1)})()},[f]),h||!t)?(0,n.jsxs)("main",{children:[(0,n.jsx)(i.default,{href:"/artists",style:{marginBottom:"1.5rem",display:"inline-block"},children:"← Back to Artists"}),(0,n.jsx)("h1",{children:"Loading..."})]}):(0,n.jsxs)("main",{children:[(0,n.jsx)(i.default,{href:"/artists",style:{marginBottom:"1.5rem",display:"inline-block"},children:"← Back to Artists"}),(0,n.jsx)(u,{artistName:t.name,artistImageUrl:t.imageUrl}),(0,n.jsx)(c,{allAlbums:(0,n.jsx)(m,{albums:d,showLibraryIcon:t=>r.some(e=>e.name===t)}),libraryAlbums:(0,n.jsx)(m,{albums:r})})]})}},3624:function(t,e,r){"use strict";r.d(e,{Z:function(){return a}});var n=r(7437);function a(){return(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{display:"inline-block",marginLeft:"8px"},children:[(0,n.jsx)("path",{d:"M2 6s1.5-2 5-2 5 2 5 2v14s-1.5-1-5-1-5 1-5 1V6z"}),(0,n.jsx)("path",{d:"M12 6s1.5-2 5-2 5 2 5 2v14s-1.5-1-5-1-5 1-5 1V6z"})]})}},6517:function(t,e,r){"use strict";r.d(e,{$:function(){return n}});let n="123"},2561:function(t,e,r){"use strict";r.d(e,{EP:function(){return R},Jl:function(){return v},Lj:function(){return k},Qj:function(){return T},UM:function(){return E},Xs:function(){return C},ZG:function(){return g},ZJ:function(){return N},Zi:function(){return _},aU:function(){return S},bN:function(){return I},eK:function(){return w},fC:function(){return O},gG:function(){return b},jB:function(){return x},k8:function(){return A},mF:function(){return j},qn:function(){return U},zK:function(){return f}});var n=r(2040),a=r.n(n);let i=null,s=null,l="audio-indexer-db",u="database",c="directoryHandle";async function o(){return s||(s=await a()({locateFile:t=>"https://sql.js.org/dist/".concat(t)}))}function m(){return new Promise((t,e)=>{let r=indexedDB.open(l,1);r.onerror=()=>e("Error opening IndexedDB"),r.onsuccess=()=>t(r.result),r.onupgradeneeded=t=>{let e=t.target.result;e.objectStoreNames.contains(u)||e.createObjectStore(u),e.objectStoreNames.contains(c)||e.createObjectStore(c)}})}async function d(){let t=await m();return new Promise((e,r)=>{let n=t.transaction(u,"readonly").objectStore(u).get("db");n.onerror=()=>r("Error loading from IndexedDB"),n.onsuccess=()=>e(n.result)})}async function E(){if(!i)return;let t=i.export();(await m()).transaction(u,"readwrite").objectStore(u).put(t,"db")}async function f(){if(i)return i;let t=await o(),e=await d();return(i=e?new t.Database(e):new t.Database)&&i.run("\n    CREATE TABLE IF NOT EXISTS artists (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT UNIQUE,\n      imageUrl TEXT\n    );\n    CREATE TABLE IF NOT EXISTS albums (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT,\n      artist_id INTEGER,\n      imageUrl TEXT,\n      FOREIGN KEY(artist_id) REFERENCES artists(id),\n      UNIQUE(name, artist_id)\n    );\n    CREATE TABLE IF NOT EXISTS tracks (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      title TEXT,\n      track TEXT,\n      path TEXT UNIQUE,\n      album_id INTEGER,\n      artist_id INTEGER,\n      FOREIGN KEY(album_id) REFERENCES albums(id),\n      FOREIGN KEY(artist_id) REFERENCES artists(id)\n    );\n  "),i}function p(t){if(!i)throw Error("Database not initialized");let e=i.prepare("SELECT id FROM artists WHERE name = ?");if(e.bind([t]),e.step()){let t=e.get()[0];return e.free(),t}e.free();let r=i.prepare("INSERT INTO artists (name) VALUES (?)");return r.run([t]),r.free(),i.exec("SELECT last_insert_rowid()")[0].values[0][0]}function h(t,e){if(!i)throw Error("Database not initialized");let r=i.prepare("SELECT id FROM albums WHERE name = ? AND artist_id = ?");if(r.bind([t,e]),r.step()){let t=r.get()[0];return r.free(),t}r.free();let n=i.prepare("INSERT INTO albums (name, artist_id) VALUES (?, ?)");return n.run([t,e]),n.free(),i.exec("SELECT last_insert_rowid()")[0].values[0][0]}function b(t){if(!i)return;let e=p(t.artist),r=h(t.album,e),n=i.prepare("INSERT INTO tracks (title, track, path, album_id, artist_id) VALUES (?, ?, ?, ?, ?)");n.run([t.title,t.track,t.path,r,e]),n.free()}function N(t){if(i){i.exec("BEGIN TRANSACTION");try{let e=i.prepare("INSERT OR IGNORE INTO tracks (title, track, path, album_id, artist_id) VALUES (?, ?, ?, ?, ?)");for(let r of t){let t=p(r.artist),n=h(r.album,t);e.run([r.title,r.track,r.path,n,t])}e.free(),i.exec("COMMIT")}catch(t){throw console.error("Bulk insert failed, rolling back.",t),i.exec("ROLLBACK"),t}}}function T(t){if(!i)return;let e=i.prepare("DELETE FROM tracks WHERE path = ?");e.run([t]),e.free()}function R(t){if(!i)return;let e=i.prepare("UPDATE artists SET imageUrl = ? WHERE name = ?");e.run([t.imageUrl,t.name]),e.free()}function g(t){if(!i)return;let e=i.prepare("SELECT id FROM artists WHERE name = ?");if(e.bind([t.artistName]),!e.step()){e.free();return}let r=e.get()[0];e.free();let n=i.prepare("UPDATE albums SET imageUrl = ? WHERE name = ? AND artist_id = ?");n.run([t.imageUrl,t.name,r]),n.free()}function O(){if(!i)return[];let t=i.prepare("SELECT id, name, imageUrl FROM artists ORDER BY name"),e=[];for(;t.step();)e.push(t.getAsObject());return t.free(),e}function S(t){if(!i)return null;let e=i.prepare("SELECT id, name, imageUrl FROM artists WHERE name = ?");if(e.bind([t]),e.step()){let t=e.getAsObject();return e.free(),t}return e.free(),null}function w(t,e){if(!i)return null;let r=i.prepare("\n      SELECT a.id, a.name, a.artist_id, a.imageUrl, r.name as artistName\n      FROM albums a\n      JOIN artists r ON a.artist_id = r.id\n      WHERE a.name = ? AND r.name = ?\n  ");if(r.bind([t,e]),r.step()){let t=r.getAsObject();return r.free(),t}return r.free(),null}function I(t){if(!i)return[];let e=i.prepare("SELECT a.id, a.name, a.artist_id, a.imageUrl, r.name as artistName\n     FROM albums a\n     JOIN artists r ON a.artist_id = r.id\n     WHERE r.name = ?\n     ORDER BY a.name");e.bind([t]);let r=[];for(;e.step();)r.push(e.getAsObject());return e.free(),r}function j(t,e){if(!i)return[];let r=i.prepare("\n      SELECT t.id, t.title, t.track, t.album_id, t.artist_id, r.name as artistName, a.name as albumName\n      FROM tracks t\n      JOIN artists r ON t.artist_id = r.id\n      JOIN albums a ON t.album_id = a.id\n      WHERE a.name = ? AND r.name = ?\n      ORDER BY CAST(t.track AS INTEGER)\n  ");r.bind([t,e]);let n=[];for(;r.step();)n.push(r.getAsObject());return r.free(),n}function A(){if(!i)return[];let t=i.prepare("\n      SELECT a.id, a.name, a.artist_id, a.imageUrl, r.name as artistName\n      FROM albums a\n      JOIN artists r ON a.artist_id = r.id\n      ORDER BY a.name\n  "),e=[];for(;t.step();)e.push(t.getAsObject());return t.free(),e}function v(){if(!i)return[];let t=i.prepare("\n      SELECT t.id, t.title, t.track, t.album_id, t.artist_id, r.name as artistName, a.name as albumName\n      FROM tracks t\n      JOIN artists r ON t.artist_id = r.id\n      JOIN albums a ON t.album_id = a.id\n      ORDER BY r.name, a.name, CAST(t.track AS INTEGER)\n  "),e=[];for(;t.step();)e.push(t.getAsObject());return t.free(),e}function x(){if(!i)return new Set;let t=i.prepare("SELECT path FROM tracks"),e=new Set;for(;t.step();)e.add(t.get()[0]);return t.free(),e}function U(){if(!i)return 0;let t=i.exec("SELECT COUNT(*) FROM artists");return 0!==t.length&&t[0].values[0]?t[0].values[0][0]:0}function C(){return i?i.export():null}async function _(t){let e=await o();i&&i.close(),i=new e.Database(t),await E()}async function k(){return i&&(i.close(),i=null),new Promise((t,e)=>{let r=indexedDB.deleteDatabase(l);r.onerror=()=>e("Error deleting database"),r.onsuccess=()=>t()})}},7138:function(t,e,r){"use strict";r.d(e,{default:function(){return a.a}});var n=r(231),a=r.n(n)}},function(t){t.O(0,[218,251,231,128,971,190,744],function(){return t(t.s=64)}),_N_E=t.O()}]);