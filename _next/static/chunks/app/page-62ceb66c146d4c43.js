(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{366:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var n=r(5155),a=r(2115),i=r(3293),s=r.n(i);let l=null,o="database";function c(){return new Promise((e,t)=>{let r=indexedDB.open("audio-indexer-db",1);r.onerror=()=>t("Error opening IndexedDB"),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{e.target.result.createObjectStore(o)}})}async function u(){let e=await c();return new Promise((t,r)=>{let n=e.transaction(o,"readonly").objectStore(o).get("db");n.onerror=()=>r("Error loading from IndexedDB"),n.onsuccess=()=>t(n.result)})}async function d(){if(!l)return;let e=l.export();(await c()).transaction(o,"readwrite").objectStore(o).put(e,"db")}async function m(){if(l)return l;let e=await s()({locateFile:e=>`https://sql.js.org/dist/${e}`}),t=await u();return l=t?new e.Database(t):new e.Database,function(){if(!l)return;let e=`
    CREATE TABLE IF NOT EXISTS tracks (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      title TEXT,
      artist TEXT,
      album TEXT,
      track TEXT
    );
  `;l.run(e)}(),l}function w(e){if(!l)return;let t=l.prepare("INSERT INTO tracks (title, artist, album, track) VALUES (?, ?, ?, ?)");t.run([e.title,e.artist,e.album,e.track]),t.free()}function E(){if(!l)return[];let e=l.exec("SELECT DISTINCT album FROM tracks ORDER BY album");return 0===e.length?[]:e[0].values.map(e=>e?.[0])}function f(){let[e,t]=(0,a.useState)([]),[i,s]=(0,a.useState)(null),[o,c]=(0,a.useState)(!1),[u,f]=(0,a.useState)(!1),[k,b]=(0,a.useState)(0);(0,a.useEffect)(()=>{c("showDirectoryPicker"in window),m().then(()=>{t(E().map(e=>({name:e,tracks:[]})))})},[]);let h=async()=>{try{f(!0),b(0);let e=await window.showDirectoryPicker(),n=[],a=async e=>{for await(let t of e.values())if("file"===t.kind){let e=t.name.toLowerCase();(e.endsWith(".mp3")||e.endsWith(".flac"))&&n.push(await t.getFile())}else"directory"===t.kind&&await a(t)};await a(e);let i=(await r.e(213).then(r.t.bind(r,3213,23))).default;for(let e=0;e<n.length;e++){let t=n[e];await new Promise(e=>{i.read(t,{onSuccess:t=>{let r=t.tags;w({title:r.title||"Unknown Title",artist:r.artist||"Unknown Artist",album:r.album||"Unknown Album",track:r.track||"0"}),e()},onError:r=>{console.error(r),w({title:t.name,artist:"Unknown Artist",album:"Unknown Album",track:"0"}),e()}})}),b((e+1)/n.length*100)}await d();let s=E().map(e=>({name:e,tracks:[]}));t(s),f(!1)}catch(e){console.error("Error selecting directory:",e),f(!1)}};return(0,n.jsxs)("main",{children:[(0,n.jsx)("h1",{children:"Audio File Indexer"}),o?(0,n.jsx)("button",{onClick:h,disabled:u,children:u?"Scanning...":"Select Directory"}):(0,n.jsx)("p",{children:"The File System Access API is not supported in your browser."}),u&&(0,n.jsx)("progress",{value:k,max:"100"}),e.length>0&&(0,n.jsx)("ul",{children:e.map(r=>(0,n.jsxs)("li",{children:[(0,n.jsx)("h2",{onClick:()=>(r=>{if(i===r)s(null);else{let n=function(e){if(!l)return[];let t=l.prepare("SELECT title, artist, album, track FROM tracks WHERE album = ? ORDER BY CAST(track AS INTEGER)");t.bind([e]);let r=[];for(;t.step();)r.push(t.getAsObject());return t.free(),r}(r);t(e.map(e=>e.name===r?{...e,tracks:n}:e)),s(r)}})(r.name),style:{cursor:"pointer"},children:r.name}),i===r.name&&(0,n.jsx)("ul",{children:r.tracks.map(e=>(0,n.jsxs)("li",{children:[e.track," - ",e.title]},e.title))})]},r.name))})]})}},3586:(e,t,r)=>{Promise.resolve().then(r.bind(r,366))},6490:()=>{}},e=>{e.O(0,[268,840,441,794,358],()=>e(e.s=3586)),_N_E=e.O()}]);