(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{366:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>f});var a=r(5155),n=r(2115),s=r(3293),i=r.n(s);let l=null,o="database";function c(){return new Promise((e,t)=>{let r=indexedDB.open("audio-indexer-db",1);r.onerror=()=>t("Error opening IndexedDB"),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{e.target.result.createObjectStore(o)}})}async function u(){let e=await c();return new Promise((t,r)=>{let a=e.transaction(o,"readonly").objectStore(o).get("db");a.onerror=()=>r("Error loading from IndexedDB"),a.onsuccess=()=>t(a.result)})}async function d(){if(!l)return;let e=l.export();(await c()).transaction(o,"readwrite").objectStore(o).put(e,"db")}async function p(){if(l)return l;let e=await i()({locateFile:e=>`https://sql.js.org/dist/${e}`}),t=await u();return l=t?new e.Database(t):new e.Database,function(){if(!l)return;let e=`
    CREATE TABLE IF NOT EXISTS tracks (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      title TEXT,
      artist TEXT,
      album TEXT,
      track TEXT
    );
  `;l.run(e)}(),l}function E(){if(!l)return[];let e=l.exec("SELECT DISTINCT album FROM tracks ORDER BY album");return 0===e.length?[]:e[0].values.map(e=>e?.[0])}function f(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(null),[o,c]=(0,n.useState)(!1),[u,f]=(0,n.useState)(!1),[m,b]=(0,n.useState)(0),h=(0,n.useRef)(null);(0,n.useEffect)(()=>(c("showDirectoryPicker"in window),p().then(()=>{t(E().map(e=>({name:e,tracks:[]})))}),h.current=new Worker(r.tu(new URL(r.p+r.u(278),r.b))),h.current.onmessage=async e=>{if("progress"===e.data.type)b(e.data.payload);else if("complete"===e.data.type){for(let t of e.data.payload)!function(e){if(!l)return;let t=l.prepare("INSERT INTO tracks (title, artist, album, track) VALUES (?, ?, ?, ?)");t.run([e.title,e.artist,e.album,e.track]),t.free()}(t);await d(),t(E().map(e=>({name:e,tracks:[]}))),f(!1)}else"error"===e.data.type&&(console.error(e.data.payload),f(!1))},()=>{h.current?.terminate()}),[]);let T=async()=>{try{f(!0),b(0);let e=await window.showDirectoryPicker();h.current?.postMessage(e)}catch(e){console.error("Error selecting directory:",e),f(!1)}};return(0,a.jsxs)("main",{children:[(0,a.jsx)("h1",{children:"Audio File Indexer"}),o?(0,a.jsx)("button",{onClick:T,disabled:u,children:u?"Scanning...":"Select Directory"}):(0,a.jsx)("p",{children:"The File System Access API is not supported in your browser."}),u&&(0,a.jsx)("progress",{value:m,max:"100"}),e.length>0&&(0,a.jsx)("ul",{children:e.map(r=>(0,a.jsxs)("li",{children:[(0,a.jsx)("h2",{onClick:()=>(r=>{if(s===r)i(null);else{let a=function(e){if(!l)return[];let t=l.prepare("SELECT title, artist, album, track FROM tracks WHERE album = ? ORDER BY CAST(track AS INTEGER)");t.bind([e]);let r=[];for(;t.step();)r.push(t.getAsObject());return t.free(),r}(r);t(e.map(e=>e.name===r?{...e,tracks:a}:e)),i(r)}})(r.name),style:{cursor:"pointer"},children:r.name}),s===r.name&&(0,a.jsx)("ul",{children:r.tracks.map(e=>(0,a.jsxs)("li",{children:[e.track," - ",e.title]},e.title))})]},r.name))})]})}},3586:(e,t,r)=>{Promise.resolve().then(r.bind(r,366))},6490:()=>{}},e=>{e.O(0,[268,619,840,441,794,358],()=>e(e.s=3586)),_N_E=e.O()}]);