(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{803:function(){},9625:function(e,t,r){Promise.resolve().then(r.bind(r,5700)),Promise.resolve().then(r.bind(r,6455)),Promise.resolve().then(r.bind(r,7717)),Promise.resolve().then(r.bind(r,3639)),Promise.resolve().then(r.t.bind(r,5195,23)),Promise.resolve().then(r.t.bind(r,3339,23)),Promise.resolve().then(r.t.bind(r,8877,23))},5700:function(e,t,r){"use strict";r.d(t,{default:function(){return u}});var n=r(7437),a=r(2265),i=r(7611),s=r(2561);function o(){let e=(0,a.useRef)(null),t=(0,a.useRef)(null);return(0,a.useEffect)(()=>{e.current=new Worker(r.tu(new URL(r.p+r.u(714),r.b)));let n=async()=>{console.log("Orchestrator starting a scan...");let t=await (0,s.yv)();if(t){var r;let n=(0,s.lZ)();null===(r=e.current)||void 0===r||r.postMessage({type:"scan",directoryHandle:t,trackIndex:n})}else console.log("ScanOrchestrator: No directory handle found. Skipping scan.")},a=e=>{t.current&&window.clearTimeout(t.current),t.current=window.setTimeout(()=>{n(),a(e)},36e5*e)},o=(0,i.r)();return"on-launch"===o.scanMode?n():"periodic"===o.scanMode&&(n(),a(o.scanIntervalHours)),()=>{var r;null===(r=e.current)||void 0===r||r.terminate(),t.current&&window.clearTimeout(t.current)}},[]),null}function u(e){let{children:t}=e;return(0,a.useEffect)(()=>{(0,s.zK)()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o,{}),t]})}},6455:function(e,t,r){"use strict";r.d(t,{default:function(){return l}});var n=r(7437),a=r(7138),i=r(1169);function s(){return(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,n.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]})}function o(){return(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,n.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,n.jsx)("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})}var u=r(3624);function l(){let e=(0,i.usePathname)(),t=[{href:"/",icon:(0,n.jsx)(s,{}),label:"Home"},{href:"/search",icon:(0,n.jsx)(o,{}),label:"Search"},{href:"/library",icon:(0,n.jsx)(u.Z,{}),label:"Library"}];return(0,n.jsx)("nav",{className:"nav-bar",children:t.map(t=>{let{href:r,icon:i,label:s}=t,o=("/library"===r?e.startsWith("/library")||e.startsWith("/artists")||e.startsWith("/artist")||e.startsWith("/albums")||e.startsWith("/album")||e.startsWith("/tracks"):"/"===r?e===r:e.startsWith(r))?"active":"";return(0,n.jsx)(a.default,{href:r,className:o,children:i},r)})})}},7717:function(e,t,r){"use strict";var n=r(7437),a=r(2265),i=r(3639);r(2609),t.default=()=>{let{status:e,found:t,processed:r,reset:s}=(0,i.w)(),[o,u]=(0,a.useState)(!1),[l,c]=(0,a.useState)(!1),[d,f]=(0,a.useState)("");return((0,a.useEffect)(()=>{"running"===e?(u(!0),c(!1),f("")):"success"===e||"error"===e?(f(e),setTimeout(()=>{c(!0),setTimeout(()=>{u(!1),s()},500)},2e3)):"idle"===e&&(u(!1),c(!1),f(""))},[e,s]),o)?(0,n.jsx)("div",{className:"scan-progress-pill ".concat(d," ").concat(l?"fade-out":""),children:"running"===e?"Scanning... ".concat(r," / ").concat(t," files"):"success"===d?"Scan complete!":"error"===d?"Scan failed!":""}):null}},3624:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});var n=r(7437);function a(){return(0,n.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{display:"inline-block",marginLeft:"8px"},children:[(0,n.jsx)("path",{d:"M2 6s1.5-2 5-2 5 2 5 2v14s-1.5-1-5-1-5 1-5 1V6z"}),(0,n.jsx)("path",{d:"M12 6s1.5-2 5-2 5 2 5 2v14s-1.5-1-5-1-5 1-5 1V6z"})]})}},3639:function(e,t,r){"use strict";r.d(t,{ScanProgressProvider:function(){return s},w:function(){return o}});var n=r(7437),a=r(2265);let i=(0,a.createContext)(void 0),s=e=>{let{children:t}=e,[r,s]=(0,a.useState)("idle"),[o,u]=(0,a.useState)(0),[l,c]=(0,a.useState)(0);return(0,n.jsx)(i.Provider,{value:{status:r,found:o,processed:l,setStatus:s,setFound:u,setProcessed:c,reset:()=>{s("idle"),u(0),c(0)}},children:t})},o=()=>{let e=(0,a.useContext)(i);if(void 0===e)throw Error("useScanProgress must be used within a ScanProgressProvider");return e}},2561:function(e,t,r){"use strict";r.d(t,{DY:function(){return j},EP:function(){return b},Jl:function(){return _},Lj:function(){return y},UM:function(){return E},Xs:function(){return v},ZG:function(){return N},ZJ:function(){return p},Zi:function(){return x},aU:function(){return h},bN:function(){return g},eK:function(){return R},fC:function(){return T},k8:function(){return O},lZ:function(){return w},mF:function(){return S},qn:function(){return I},yv:function(){return k},zK:function(){return m}});var n=r(2040),a=r.n(n);let i=null,s=null,o="audio-indexer-db",u="database",l="directoryHandle";async function c(){return s||(s=await a()({locateFile:e=>"https://sql.js.org/dist/".concat(e)}))}function d(){return new Promise((e,t)=>{let r=indexedDB.open(o,1);r.onerror=()=>t("Error opening IndexedDB"),r.onsuccess=()=>e(r.result),r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(u)||t.createObjectStore(u),t.objectStoreNames.contains(l)||t.createObjectStore(l)}})}async function f(){let e=await d();return new Promise((t,r)=>{let n=e.transaction(u,"readonly").objectStore(u).get("db");n.onerror=()=>r("Error loading from IndexedDB"),n.onsuccess=()=>t(n.result)})}async function E(){if(!i)return;let e=i.export();(await d()).transaction(u,"readwrite").objectStore(u).put(e,"db")}async function m(){if(i)return i;let e=await c(),t=await f();return(i=t?new e.Database(t):new e.Database)&&i.run("\n    CREATE TABLE IF NOT EXISTS artists (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT UNIQUE,\n      imageUrl TEXT\n    );\n    CREATE TABLE IF NOT EXISTS albums (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      name TEXT,\n      artist_id INTEGER,\n      imageUrl TEXT,\n      FOREIGN KEY(artist_id) REFERENCES artists(id),\n      UNIQUE(name, artist_id)\n    );\n    CREATE TABLE IF NOT EXISTS tracks (\n      id INTEGER PRIMARY KEY AUTOINCREMENT,\n      title TEXT,\n      track TEXT,\n      path TEXT UNIQUE,\n      lastModified INTEGER,\n      size INTEGER,\n      album_id INTEGER,\n      artist_id INTEGER,\n      FOREIGN KEY(album_id) REFERENCES albums(id),\n      FOREIGN KEY(artist_id) REFERENCES artists(id)\n    );\n  "),i}function p(e){if(i){i.exec("BEGIN TRANSACTION");try{let t=i.prepare("INSERT OR IGNORE INTO tracks (title, track, path, lastModified, size, album_id, artist_id) VALUES (?, ?, ?, ?, ?, ?, ?)");for(let r of e){let e=function(e){if(!i)throw Error("Database not initialized");let t=i.prepare("SELECT id FROM artists WHERE name = ?");if(t.bind([e]),t.step()){let e=t.get()[0];return t.free(),e}t.free();let r=i.prepare("INSERT INTO artists (name) VALUES (?)");return r.run([e]),r.free(),i.exec("SELECT last_insert_rowid()")[0].values[0][0]}(r.artist),n=function(e,t){if(!i)throw Error("Database not initialized");let r=i.prepare("SELECT id FROM albums WHERE name = ? AND artist_id = ?");if(r.bind([e,t]),r.step()){let e=r.get()[0];return r.free(),e}r.free();let n=i.prepare("INSERT INTO albums (name, artist_id) VALUES (?, ?)");return n.run([e,t]),n.free(),i.exec("SELECT last_insert_rowid()")[0].values[0][0]}(r.album,e);t.run([r.title,r.track,r.path,r.lastModified,r.size,n,e])}t.free(),i.exec("COMMIT")}catch(e){throw console.error("Bulk insert failed, rolling back.",e),i.exec("ROLLBACK"),e}}}function b(e){if(!i)return;let t=i.prepare("UPDATE artists SET imageUrl = ? WHERE name = ?");t.run([e.imageUrl,e.name]),t.free()}function N(e){if(!i)return;let t=i.prepare("SELECT id FROM artists WHERE name = ?");if(t.bind([e.artistName]),!t.step()){t.free();return}let r=t.get()[0];t.free();let n=i.prepare("UPDATE albums SET imageUrl = ? WHERE name = ? AND artist_id = ?");n.run([e.imageUrl,e.name,r]),n.free()}function T(){if(!i)return[];let e=i.prepare("SELECT id, name, imageUrl FROM artists ORDER BY name"),t=[];for(;e.step();)t.push(e.getAsObject());return e.free(),t}function h(e){if(!i)return null;let t=i.prepare("SELECT id, name, imageUrl FROM artists WHERE name = ?");if(t.bind([e]),t.step()){let e=t.getAsObject();return t.free(),e}return t.free(),null}function R(e,t){if(!i)return null;let r=i.prepare("\n      SELECT a.id, a.name, a.artist_id, a.imageUrl, r.name as artistName\n      FROM albums a\n      JOIN artists r ON a.artist_id = r.id\n      WHERE a.name = ? AND r.name = ?\n  ");if(r.bind([e,t]),r.step()){let e=r.getAsObject();return r.free(),e}return r.free(),null}function g(e){if(!i)return[];let t=i.prepare("SELECT a.id, a.name, a.artist_id, a.imageUrl, r.name as artistName\n     FROM albums a\n     JOIN artists r ON a.artist_id = r.id\n     WHERE r.name = ?\n     ORDER BY a.name");t.bind([e]);let r=[];for(;t.step();)r.push(t.getAsObject());return t.free(),r}function S(e,t){if(!i)return[];let r=i.prepare("\n      SELECT t.id, t.title, t.track, t.album_id, t.artist_id, r.name as artistName, a.name as albumName\n      FROM tracks t\n      JOIN artists r ON t.artist_id = r.id\n      JOIN albums a ON t.album_id = a.id\n      WHERE a.name = ? AND r.name = ?\n      ORDER BY CAST(t.track AS INTEGER)\n  ");r.bind([e,t]);let n=[];for(;r.step();)n.push(r.getAsObject());return r.free(),n}function O(){if(!i)return[];let e=i.prepare("\n      SELECT a.id, a.name, a.artist_id, a.imageUrl, r.name as artistName\n      FROM albums a\n      JOIN artists r ON a.artist_id = r.id\n      ORDER BY a.name\n  "),t=[];for(;e.step();)t.push(e.getAsObject());return e.free(),t}function _(){if(!i)return[];let e=i.prepare("\n      SELECT t.id, t.title, t.track, t.album_id, t.artist_id, r.name as artistName, a.name as albumName\n      FROM tracks t\n      JOIN artists r ON t.artist_id = r.id\n      JOIN albums a ON t.album_id = a.id\n      ORDER BY r.name, a.name, CAST(t.track AS INTEGER)\n  "),t=[];for(;e.step();)t.push(e.getAsObject());return e.free(),t}function w(){if(!i)return{};let e=i.prepare("SELECT path, lastModified, size FROM tracks"),t={};for(;e.step();){let r=e.get(),n=r[0],a=r[1],i=r[2];t[n]={lastModified:a,size:i}}return e.free(),t}function I(){if(!i)return 0;let e=i.exec("SELECT COUNT(*) FROM artists");return 0!==e.length&&e[0].values[0]?e[0].values[0][0]:0}function v(){return i?i.export():null}async function x(e){let t=await c();i&&i.close(),i=new t.Database(e),await E()}async function y(){return i&&(i.close(),i=null),new Promise((e,t)=>{let r=indexedDB.deleteDatabase(o);r.onerror=()=>t("Error deleting database"),r.onsuccess=()=>e()})}async function j(e){(await d()).transaction(l,"readwrite").objectStore(l).put(e,"directoryHandle")}async function k(){let e=await d();return new Promise((t,r)=>{let n=e.transaction(l,"readonly").objectStore(l).get("directoryHandle");n.onerror=()=>r("Error loading directory handle from IndexedDB"),n.onsuccess=()=>t(n.result)})}},7611:function(e,t,r){"use strict";r.d(t,{r:function(){return i},z:function(){return s}});let n="my-music-library-settings",a={scanMode:"on-launch",scanIntervalHours:6};function i(){try{let e=localStorage.getItem(n);if(e){let t=JSON.parse(e);if(t.scanMode&&t.scanIntervalHours)return t}}catch(e){console.error("Failed to load settings from localStorage:",e)}return a}function s(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(e){console.error("Failed to save settings to localStorage:",e)}}},2609:function(){},8877:function(){},5195:function(e){e.exports={style:{fontFamily:"'__Inter_c74f7c', '__Inter_Fallback_c74f7c'",fontStyle:"normal"},className:"__className_c74f7c",variable:"__variable_c74f7c"}},3339:function(e){e.exports={style:{fontFamily:"'__Roboto_Mono_ce946e', '__Roboto_Mono_Fallback_ce946e'",fontStyle:"normal"},className:"__className_ce946e",variable:"__variable_ce946e"}}},function(e){e.O(0,[369,218,646,231,26,971,190,744],function(){return e(e.s=9625)}),_N_E=e.O()}]);